# 如何查看训练记录中的参数

## 当前系统的工作方式

### 1. 参数保存机制

训练脚本 `multi_drone_ppo_train.py` 在训练开始时会将所有配置参数保存到：
```
logs/{实验名称}/cfgs.pkl
```

这个文件包含：
- `env_cfg`: 环境配置（障碍物、无人机位置等）
- `obs_cfg`: 观测配置
- `reward_cfg`: 奖励配置
- `command_cfg`: 命令配置
- `train_cfg`: PPO训练配置（学习率、网络结构等）

### 2. 如何查看参数

#### 方法1：使用查看脚本（推荐）

```bash
# 查看默认实验的参数
python view_training_params.py -e multi-drone-ppo-v2

# 查看特定检查点的参数（确认该检查点存在）
python view_training_params.py -e multi-drone-ppo-v2 --ckpt 1400

# 导出为Markdown格式
python view_training_params.py -e multi-drone-ppo-v2 --ckpt 1400 --format markdown --output params_1400pt.md

# 导出为JSON格式
python view_training_params.py -e multi-drone-ppo-v2 --ckpt 1400 --format json --output params_1400pt.json
```

#### 方法2：直接读取配置文件

```python
import pickle

log_dir = "logs/multi-drone-ppo-v2"
cfg_path = f"{log_dir}/cfgs.pkl"

env_cfg, obs_cfg, reward_cfg, command_cfg, train_cfg = pickle.load(open(cfg_path, "rb"))

# 查看PPO超参数
print("PPO算法参数:", train_cfg["algorithm"])
print("策略网络参数:", train_cfg["policy"])

# 查看奖励参数
print("奖励参数:", reward_cfg["reward_scales"])

# 查看环境参数
print("环境参数:", {
    "num_drones": env_cfg["num_drones"],
    "episode_length_s": env_cfg["episode_length_s"],
    "obstacle_safe_distance": env_cfg["obstacle_safe_distance"],
    # ... 其他参数
})
```

### 3. 重要注意事项

#### ⚠️ 参数可能变化的情况

1. **从头训练**：所有检查点使用相同的参数（`cfgs.pkl` 中的参数）

2. **恢复训练（不使用 --update_config）**：
   - 使用原始训练时的参数
   - 所有检查点（包括新训练的）都使用相同的参数

3. **恢复训练（使用 --update_config）**：
   - `cfgs.pkl` 文件会被更新为新参数
   - **旧检查点（恢复训练前保存的）使用的是旧参数**
   - **新检查点（恢复训练后保存的）使用的是新参数**
   - ⚠️ **这是当前系统的局限性：无法区分哪些检查点使用了哪些参数**

#### 示例场景

假设你进行了以下训练：

1. **初始训练**（0-800 iterations）：
   ```bash
   python multi_drone_ppo_train.py -e multi-drone-ppo-v2 --max_iterations 800
   ```
   - 保存了 `model_100.pt`, `model_200.pt`, ..., `model_800.pt`
   - 参数保存在 `cfgs.pkl`（例如：`learning_rate: 0.00015`）

2. **恢复训练（更新参数）**（800-1400 iterations）：
   ```bash
   python multi_drone_ppo_train.py -e multi-drone-ppo-v2 --max_iterations 1400 --resume --ckpt 800 --update_config
   ```
   - 修改了代码中的参数（例如：`learning_rate: 0.0001`）
   - `cfgs.pkl` 被更新为新参数
   - 保存了 `model_900.pt`, `model_1000.pt`, ..., `model_1400.pt`

3. **查看参数**：
   - `view_training_params.py` 会显示**新参数**（`learning_rate: 0.0001`）
   - 但实际上 `model_800.pt` 及之前的检查点使用的是**旧参数**（`learning_rate: 0.00015`）
   - 只有 `model_900.pt` 及之后的检查点使用的是**新参数**

### 4. 如何确定 1400pt 的参数

对于 `multi-drone-ppo-v2` 中的 `1400pt` 模型：

1. **如果训练是从头开始的**（没有使用 `--resume --update_config`）：
   ```bash
   python view_training_params.py -e multi-drone-ppo-v2 --ckpt 1400
   ```
   显示的参数就是 `1400pt` 使用的参数。

2. **如果训练是恢复的**：
   - 需要查看训练历史记录
   - 或者查看代码的 git 历史，确定在训练 `1400pt` 时使用的参数
   - 或者查看 `v2_parameters_record.md` 文件（如果记录了）

3. **查看 v2_parameters_record.md**：
   这个文件记录了 v2 版本的通用参数，可以作为参考。

### 5. 改进建议

为了避免参数混淆，建议：

1. **在保存检查点时也保存参数快照**：
   - 每次保存 `model_X.pt` 时，同时保存 `params_X.pkl`
   - 这样可以准确追踪每个检查点的参数

2. **在训练日志中记录参数变化**：
   - 如果使用了 `--update_config`，在日志中记录参数变化历史

3. **使用版本控制**：
   - 在训练前提交代码，这样可以通过 git 历史查看参数

## 快速查看命令

```bash
# 查看 multi-drone-ppo-v2 中 1400pt 的参数
python view_training_params.py -e multi-drone-ppo-v2 --ckpt 1400

# 导出为文档
python view_training_params.py -e multi-drone-ppo-v2 --ckpt 1400 --format markdown --output params_1400pt.md
```















